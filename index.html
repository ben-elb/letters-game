<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×›×™×£ ×¢× ×”×-×‘</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="××©×—×§ ××•×ª×™×•×ª">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- ×¡×¤×¨×™×™×” ×œ×§×•× ×¤×˜×™ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            font-family: system-ui, -apple-system, sans-serif;
            padding-bottom: 80px; /* ××§×•× ×œ×ª×¤×¨×™×˜ ×”×ª×—×ª×•×Ÿ */
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .zoom-in { animation: zoomIn 0.3s ease-out; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .bounce { animation: bounce 0.5s infinite alternate; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body class="bg-blue-50 min-h-screen text-right">

    <!-- ×›×•×ª×¨×ª ×¨××©×™×ª (××©×ª× ×” ×œ×¤×™ ×”×˜××‘) -->
    <div class="max-w-4xl mx-auto text-center pt-10 pb-4 px-4">
        <h1 id="main-title" class="text-4xl md:text-6xl font-bold text-blue-600 mb-2 drop-shadow-sm">
            ×›Ö¼Öµ×™×£ ×¢Ö´× ×”Ö¸×-×‘ ğŸ¨
        </h1>
        <p id="sub-title" class="text-xl text-blue-400 font-medium">
            ×œÖ·×—Ö²×¦×•Ö¼ ×¢Ö·×œ ××•Ö¹×ª ×›Ö¼Ö°×“Öµ×™ ×œÖ´×©×Ö°×Ö¹×¢Ö· ×•Ö¼×œÖ°×©×‚Ö·×—Öµ×§!
        </p>
    </div>

    <!-- ========================= -->
    <!-- ××–×•×¨ ×”×œ×™××•×“ (Learning View) -->
    <!-- ========================= -->
    <div id="view-learn" class="fade-in">
        <div id="game-board" class="max-w-5xl mx-auto grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4">
            <!-- ×”××•×ª×™×•×ª ×™×•×–×¨×§×• ×œ×›××Ÿ -->
        </div>
    </div>

    <!-- ========================= -->
    <!-- ××–×•×¨ ×”××‘×—×Ÿ (Quiz View) -->
    <!-- ========================= -->
    <div id="view-quiz" class="hidden fade-in px-4">
        <div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-xl p-6 border-4 border-purple-200 mt-4 relative">
            
            <!-- × ×™×§×•×“ -->
            <div class="absolute top-4 left-4 flex items-center gap-2 bg-yellow-100 px-3 py-1 rounded-full">
                <i data-lucide="star" class="text-yellow-500 fill-yellow-500 w-5 h-5"></i>
                <span id="score-display" class="font-bold text-yellow-700 text-lg">0</span>
            </div>

            <!-- ××–×•×¨ ×”×©××œ×” -->
            <div class="text-center mb-8 mt-6">
                <button onclick="playQuizPrompt()" class="bg-purple-100 hover:bg-purple-200 text-purple-600 p-6 rounded-full transition-all active:scale-95 shadow-md mx-auto block mb-4">
                    <i data-lucide="volume-2" class="w-12 h-12"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-700">×Öµ×™×¤Ö¹×” ×”Ö¸××•Ö¹×ª <span id="quiz-target-letter" class="text-purple-600 text-3xl">?</span></h2>
            </div>

            <!-- ××¤×©×¨×•×™×•×ª ×ª×©×•×‘×” -->
            <div id="quiz-options" class="grid grid-cols-2 gap-4">
                <!-- ×”××¤×©×¨×•×™×•×ª ×™×•×–×¨×§×• ×œ×›××Ÿ -->
            </div>
            
            <div id="feedback-msg" class="text-center mt-6 h-8 font-bold text-xl"></div>
        </div>
    </div>

    <!-- ========================= -->
    <!-- ×—×œ×•× ×™×ª ×œ×™××•×“ (Modal) -->
    <!-- ========================= -->
    <div id="modal" class="fixed inset-0 z-40 hidden bg-black/40 backdrop-blur-sm overflow-y-auto fade-in">
        <div class="flex min-h-full items-center justify-center p-2 sm:p-4">
            <div class="relative w-full max-w-3xl bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-yellow-300 my-4 zoom-in">
                <button onclick="closeModal()" class="absolute top-4 left-4 p-2 bg-red-100 text-red-500 rounded-full hover:bg-red-200 z-20 shadow-sm"><i data-lucide="x" class="w-6 h-6"></i></button>
                <button onclick="navigatePrev(event)" class="absolute top-1/2 right-2 -translate-y-1/2 z-10 p-2 sm:p-4 bg-white/80 text-blue-600 rounded-full shadow-lg border-2 border-blue-200 active:scale-95"><i data-lucide="chevron-right" class="w-8 h-8"></i></button>
                <button onclick="navigateNext(event)" class="absolute top-1/2 left-2 -translate-y-1/2 z-10 p-2 sm:p-4 bg-white/80 text-blue-600 rounded-full shadow-lg border-2 border-blue-200 active:scale-95"><i data-lucide="chevron-left" class="w-8 h-8"></i></button>

                <div class="flex flex-col items-center p-6 sm:p-12 bg-gradient-to-b from-yellow-50 to-white px-12 sm:px-24">
                    <div class="text-center w-full mt-4">
                        <div id="modal-letter" class="text-8xl md:text-9xl font-bold text-blue-600 drop-shadow-md select-none"></div>
                        <button onclick="replayLetter()" class="mt-6 flex items-center justify-center gap-2 bg-blue-500 text-white px-6 py-3 rounded-full font-bold text-lg hover:bg-blue-600 shadow-md active:scale-95 mx-auto">
                            <i data-lucide="volume-2" class="w-6 h-6"></i> <span>×”Ö·×©×Ö°×Ö·×¢ ×©××•Ö¼×‘</span>
                        </button>
                    </div>
                    <div class="w-full h-1 bg-blue-100 rounded-full my-8"></div>
                    <div class="w-full">
                        <h3 class="text-center text-xl text-gray-500 mb-6 font-bold" id="modal-subtitle"></h3>
                        <div id="words-container" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================= -->
    <!-- ×ª×¤×¨×™×˜ × ×™×•×•×˜ ×ª×—×ª×•×Ÿ (Bottom Nav) -->
    <!-- ========================= -->
    <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-lg z-50 flex justify-around items-center p-3 pb-6 sm:pb-3">
        <button onclick="switchTab('learn')" id="btn-tab-learn" class="flex flex-col items-center gap-1 text-blue-600 transition-colors">
            <div class="p-2 rounded-xl bg-blue-100 transition-colors" id="icon-bg-learn">
                <i data-lucide="book-open" class="w-6 h-6"></i>
            </div>
            <span class="text-xs font-bold">×œÖ´×™×Ö¼×•Ö¼×“</span>
        </button>

        <button onclick="switchTab('quiz')" id="btn-tab-quiz" class="flex flex-col items-center gap-1 text-gray-400 transition-colors">
            <div class="p-2 rounded-xl bg-transparent transition-colors" id="icon-bg-quiz">
                <i data-lucide="gamepad-2" class="w-6 h-6"></i>
            </div>
            <span class="text-xs font-bold">×Ö´×©×‚Ö°×—Ö¸×§</span>
        </button>
    </div>

    <script>
        // --- DATA ---
        const alphabetData = [
            { letter: '×', name: '×Ö¸×œÖ¶×£', phonetic: 'Aleph', words: [{ text: '×Ö·×¨Ö°× Ö¸×‘', emoji: 'ğŸ°' }, { text: '×Ö²×‘Ö·×˜Ö¼Ö´×™×—Ö·', emoji: 'ğŸ‰' }, { text: '×Ö·×¨Ö°×™Öµ×”', emoji: 'ğŸ¦' }] },
            { letter: '×‘', name: '×‘Ö¼Öµ×™×ª', phonetic: 'Bet', words: [{ text: '×‘Ö¼Ö·×™Ö´×ª', emoji: 'ğŸ ' }, { text: '×‘Ö¼Ö·× Ö¼Ö¸× Ö¸×”', emoji: 'ğŸŒ' }, { text: '×‘Ö¼Ö·×¨Ö°×•Ö¸×–', emoji: 'ğŸ¦†' }] },
            { letter: '×’', name: '×’Ö¼Ö´×™×Ö¶×œ', phonetic: 'Gimel', words: [{ text: '×’Ö¼Ö¸×Ö¸×œ', emoji: 'ğŸ«' }, { text: '×’Ö¼Ö°×œÖ´×™×“Ö¸×”', emoji: 'ğŸ¦' }, { text: '×’Ö¼Ö´×™×˜Ö¸×¨Ö¸×”', emoji: 'ğŸ¸' }] },
            { letter: '×“', name: '×“Ö¼Ö¸×œÖ¶×ª', phonetic: 'Dalet', words: [{ text: '×“Ö¼Ö¶×œÖ¶×ª', emoji: 'ğŸšª' }, { text: '×“Ö¼Ö¸×’', emoji: 'ğŸŸ' }, { text: '×“Ö¼Ö»×‘Ö¼Ö´×™', emoji: 'ğŸ§¸' }] },
            { letter: '×”', name: '×”Öµ×', phonetic: 'Hay', words: [{ text: '×”Ö·×¨', emoji: 'â›°ï¸' }, { text: '×”Ö¶×œÖ´×™×§×•Ö¹×¤Ö¼Ö°×˜Öµ×¨', emoji: 'ğŸš' }, { text: '×”Ö´×™×¤Ö¼×•Ö¹×¤Ö¼×•Ö¹×˜Ö¸×', emoji: 'ğŸ¦›' }] },
            { letter: '×•', name: '×•Ö¸×™×•', phonetic: 'Vav', words: [{ text: '×•Ö¶×¨Ö¶×“', emoji: 'ğŸŒ¹' }, { text: '×•Ö´×™×œ×•Ö¹×Ÿ', emoji: 'ğŸªŸ' }, { text: '×•Ö·×¤Ö°×œ', emoji: 'ğŸ§‡' }] },
            { letter: '×–', name: '×–Ö·×™Ö´×Ÿ', phonetic: 'Zayin', words: [{ text: '×–Ö°×‘Ö¼×•Ö¼×‘', emoji: 'ğŸª°' }, { text: '×–Ö¶×‘Ö¼Ö°×¨Ö¸×”', emoji: 'ğŸ¦“' }, { text: '×–Ö·×™Ö´×ª', emoji: 'ğŸ«’' }] },
            { letter: '×—', name: '×—Öµ×™×ª', phonetic: '×—Öµ×™×ª', words: [{ text: '×—Ö¸×ª×•Ö¼×œ', emoji: 'ğŸˆ' }, { text: '×—Ö·×œÖ¼×•Ö¹×Ÿ', emoji: 'ğŸªŸ' }, { text: '×—Ö·×Ö¼Ö¸× Ö´×™Ö¼Ö¸×”', emoji: 'ğŸŒ»' }] },
            { letter: '×˜', name: '×˜Öµ×™×ª', phonetic: 'Tet', words: [{ text: '×˜Ö¶×œÖ¶×¤×•Ö¹×Ÿ', emoji: 'â˜ï¸' }, { text: '×˜Ö·×•Ö¼Ö¸×¡', emoji: 'ğŸ¦š' }, { text: '×˜Ö´×™×œ', emoji: 'ğŸš€' }] },
            { letter: '×™', name: '×™×•Ö¹×“', phonetic: 'Yod', words: [{ text: '×™Ö¸×“', emoji: 'âœ‹' }, { text: '×™Ö¸×¨Öµ×—Ö·', emoji: 'ğŸŒ™' }, { text: '×™Ö·× Ö°×©××•Ö¼×£', emoji: 'ğŸ¦‰' }] },
            { letter: '×›', name: '×›Ö¼Ö·×£', phonetic: 'Kaf', words: [{ text: '×›Ö¼Ö·×“Ö¼×•Ö¼×¨', emoji: 'âš½' }, { text: '×›Ö¼Ö¶×œÖ¶×‘', emoji: 'ğŸ•' }, { text: '×›Ö¼×•Ö¹×‘Ö·×¢', emoji: 'ğŸ§¢' }] },
            { letter: '×œ', name: '×œÖ¸×Ö¶×“', phonetic: 'Lah-med', words: [{ text: '×œÖ´×™××•Ö¹×Ÿ', emoji: 'ğŸ‹' }, { text: '×œÖµ×‘', emoji: 'â¤ï¸' }, { text: '×œÖ´×•Ö°×™Ö¸×ªÖ¸×Ÿ', emoji: 'ğŸ‹' }] },
            { letter: '×', name: '×Öµ×', phonetic: 'Mem', words: [{ text: '×Ö°×›×•Ö¹× Ö´×™×ª', emoji: 'ğŸš—' }, { text: '×Ö·×˜Ö¼×•Ö¹×¡', emoji: 'âœˆï¸' }, { text: '×Ö¶×œÖ¶×šÖ°', emoji: 'ğŸ‘‘' }] },
            { letter: '× ', name: '× ×•Ö¼×Ÿ', phonetic: 'Noon', words: [{ text: '× Öµ×¨', emoji: 'ğŸ•¯ï¸' }, { text: '× Ö¸×—Ö¸×©×', emoji: 'ğŸ' }, { text: '× Ö·×¢Ö·×œ', emoji: 'ğŸ‘Ÿ' }] },
            { letter: '×¡', name: '×¡Ö¸×Ö¶×šÖ°', phonetic: '×¡Ö¸×Ö¶×šÖ°', words: [{ text: '×¡×•Ö¼×¡', emoji: 'ğŸ´' }, { text: '×¡Öµ×¤Ö¶×¨', emoji: 'ğŸ“–' }, { text: '×¡Ö»×›Ö¼Ö¸×¨Ö´×™Ö¼Ö¸×”', emoji: 'ğŸ¬' }] },
            { letter: '×¢', name: '×¢Ö·×™Ö´×Ÿ', phonetic: 'Ah-yin', words: [{ text: '×¢Ö·×™Ö´×Ÿ', emoji: 'ğŸ‘ï¸' }, { text: '×¢Öµ×¥', emoji: 'ğŸŒ³' }, { text: '×¢×•Ö¼×’Ö¸×”', emoji: 'ğŸ‚' }] },
            { letter: '×¤', name: '×¤Ö¼Öµ×', phonetic: 'Pay', words: [{ text: '×¤Ö¼Ö´×™×œ', emoji: 'ğŸ˜' }, { text: '×¤Ö¼Ö·×¨Ö°×¤Ö¼Ö·×¨', emoji: 'ğŸ¦‹' }, { text: '×¤Ö¼Ö¶×¨Ö·×—', emoji: 'ğŸŒ¸' }] },
            { letter: '×¦', name: '×¦Ö¸×“Ö´×™', phonetic: '×¦Ö·×“Ö¼Ö´×™×§', words: [{ text: '×¦Ö¸×‘', emoji: 'ğŸ¢' }, { text: '×¦Ö´×¤Ö¼×•Ö¹×¨', emoji: 'ğŸ¦' }, { text: '×¦Ö°×¤Ö·×¨Ö°×“Ö¼Öµ×¢Ö·', emoji: 'ğŸ¸' }] },
            { letter: '×§', name: '×§×•Ö¼×£', phonetic: 'Koof', words: [{ text: '×§×•Ö¹×£', emoji: 'ğŸ’' }, { text: '×§Ö´×™×¤Ö¼×•Ö¹×“', emoji: 'ğŸ¦”' }, { text: '×§Ö·×§Ö°×˜×•Ö¼×¡', emoji: 'ğŸŒµ' }] },
            { letter: '×¨', name: '×¨Öµ×™×©×', phonetic: 'Resh', words: [{ text: '×¨Ö·×›Ö¼Ö¶×‘Ö¶×ª', emoji: 'ğŸš‚' }, { text: '×¨Ö¹××©×', emoji: 'ğŸ—£ï¸' }, { text: '×¨Ö°×Ö°×–×•Ö¹×¨', emoji: 'ğŸš¦' }] },
            { letter: '×©', name: '×©×Ö´×™×Ÿ', phonetic: 'Sheen', words: [{ text: '×©×Ö¶×Ö¶×©×', emoji: 'â˜€ï¸' }, { text: '×©×Ö¸×¢×•Ö¹×Ÿ', emoji: 'âŒš' }, { text: '×©××•Ö¹×§×•Ö¹×œÖ¸×“', emoji: 'ğŸ«' }] },
            { letter: '×ª', name: '×ªÖ¼Ö¸×™×•', phonetic: 'Tav', words: [{ text: '×ªÖ¼Ö·×¤Ö¼×•Ö¼×—Ö·', emoji: 'ğŸ' }, { text: '×ªÖ¼×•Ö¼×ª', emoji: 'ğŸ“' }, { text: '×ªÖ¼Ö´×™× ×•Ö¹×§', emoji: 'ğŸ‘¶' }] }
        ];

        let selectedIndex = null;
        let voices = [];
        let currentTab = 'learn';
        let quizScore = 0;
        let currentQuizTarget = null;
        let isQuizLocked = false; // ××•× ×¢ ×œ×—×™×¦×•×ª ×›×¤×•×œ×•×ª

        lucide.createIcons();

        // --- AUDIO ENGINE ---
        function loadVoices() { voices = window.speechSynthesis.getVoices(); }
        window.speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        function speak(text, filename) {
            window.speechSynthesis.cancel();
            if (filename) {
                const audio = new Audio('audio/' + filename);
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('Audio file missing, using TTS fallback');
                        speakTTS(text);
                    });
                }
            } else {
                speakTTS(text);
            }
        }

        function speakTTS(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            const isHebrew = /[\u0590-\u05FF]/.test(text);
            const targetVoice = voices.find(v => v.lang.includes(isHebrew ? 'he' : 'en'));
            if (targetVoice) utterance.voice = targetVoice;
            utterance.lang = isHebrew ? 'he-IL' : 'en-US';
            utterance.pitch = isHebrew ? 1.2 : 1.1;
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }

        // --- NAVIGATION LOGIC ---
        function switchTab(tab) {
            currentTab = tab;
            
            // UI Updates
            const learnView = document.getElementById('view-learn');
            const quizView = document.getElementById('view-quiz');
            const learnBtn = document.getElementById('btn-tab-learn');
            const quizBtn = document.getElementById('btn-tab-quiz');
            const learnIconBg = document.getElementById('icon-bg-learn');
            const quizIconBg = document.getElementById('icon-bg-quiz');
            const mainTitle = document.getElementById('main-title');
            const subTitle = document.getElementById('sub-title');

            if (tab === 'learn') {
                learnView.classList.remove('hidden');
                quizView.classList.add('hidden');
                
                learnBtn.classList.replace('text-gray-400', 'text-blue-600');
                quizBtn.classList.replace('text-purple-600', 'text-gray-400');
                
                learnIconBg.classList.replace('bg-transparent', 'bg-blue-100');
                quizIconBg.classList.replace('bg-purple-100', 'bg-transparent');

                mainTitle.innerText = "×›Ö¼Öµ×™×£ ×¢Ö´× ×”Ö¸×-×‘ ğŸ¨";
                mainTitle.classList.replace('text-purple-600', 'text-blue-600');
                subTitle.innerText = "×œÖ·×—Ö²×¦×•Ö¼ ×¢Ö·×œ ××•Ö¹×ª ×›Ö¼Ö°×“Öµ×™ ×œÖ´×©×Ö°×Ö¹×¢Ö· ×•Ö¼×œÖ°×©×‚Ö·×—Öµ×§!";
            } else {
                learnView.classList.add('hidden');
                quizView.classList.remove('hidden');
                
                quizBtn.classList.replace('text-gray-400', 'text-purple-600');
                learnBtn.classList.replace('text-blue-600', 'text-gray-400');
                
                quizIconBg.classList.replace('bg-transparent', 'bg-purple-100');
                learnIconBg.classList.replace('bg-blue-100', 'bg-transparent');

                mainTitle.innerText = "×Ö´×‘Ö°×—Ö¸×Ÿ ×”Ö¸××•Ö¹×ªÖ´×™Ö¼×•Ö¹×ª ğŸ†";
                mainTitle.classList.replace('text-blue-600', 'text-purple-600');
                subTitle.innerText = "×”Ö·×§Ö°×©×Ö´×™×‘×•Ö¼ ×•Ö¼×Ö´×¦Ö°××•Ö¼ ×Ö¶×ª ×”Ö¸××•Ö¹×ª ×”Ö·× Ö¼Ö°×›×•Ö¹× Ö¸×”!";

                startNewQuizRound();
            }
        }

        // --- LEARN MODE LOGIC ---
        const board = document.getElementById('game-board');
        alphabetData.forEach((item, index) => {
            const btn = document.createElement('button');
            btn.className = "bg-white rounded-2xl shadow-lg border-b-4 border-blue-200 active:border-b-0 active:translate-y-1 transition-all duration-150 p-6 flex flex-col items-center justify-center hover:bg-yellow-50 focus:outline-none";
            btn.onclick = () => openModal(index);
            btn.innerHTML = `
                <span class="text-6xl font-bold text-gray-800 mb-2">${item.letter}</span>
                <span class="text-gray-400 text-sm font-medium">${item.name}</span>
            `;
            board.appendChild(btn);
        });

        // --- MODAL LOGIC (Learn Mode) ---
        const modal = document.getElementById('modal');
        const modalLetter = document.getElementById('modal-letter');
        const modalSubtitle = document.getElementById('modal-subtitle');
        const wordsContainer = document.getElementById('words-container');

        function openModal(index) {
            selectedIndex = index;
            updateModalContent();
            modal.classList.remove('hidden');
            const item = alphabetData[index];
            speak(item.phonetic, `letter_${index + 1}.mp3`);
        }

        function updateModalContent() {
            if (selectedIndex === null) return;
            const item = alphabetData[selectedIndex];
            modalLetter.innerText = item.letter;
            modalSubtitle.innerText = `×Ö´×™×œÖ¼Ö´×™× ×”Ö·×Ö¼Ö·×ªÖ°×—Ö´×™×œ×•Ö¹×ª ×‘Ö¼Ö¸××•Ö¹×ª ${item.letter}:`;
            wordsContainer.innerHTML = '';
            item.words.forEach((word, wordIndex) => {
                const wordBtn = document.createElement('button');
                wordBtn.className = "flex flex-col items-center justify-center bg-white p-4 rounded-xl border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-all active:scale-95 shadow-sm";
                wordBtn.onclick = () => speak(word.text, `word_${selectedIndex + 1}_${wordIndex + 1}.mp3`);
                wordBtn.innerHTML = `
                    <span class="text-6xl mb-3 filter drop-shadow-sm">${word.emoji}</span>
                    <span class="text-2xl font-bold text-gray-700">${word.text}</span>
                `;
                wordsContainer.appendChild(wordBtn);
            });
        }

        function closeModal() {
            modal.classList.add('hidden');
            selectedIndex = null;
            window.speechSynthesis.cancel();
        }

        function replayLetter() {
            if (selectedIndex !== null) {
                const item = alphabetData[selectedIndex];
                speak(item.phonetic, `letter_${selectedIndex + 1}.mp3`);
            }
        }

        function navigateNext(e) {
            e.stopPropagation();
            if (selectedIndex !== null) {
                selectedIndex = (selectedIndex + 1) % alphabetData.length;
                updateModalContent();
                replayLetter();
            }
        }

        function navigatePrev(e) {
            e.stopPropagation();
            if (selectedIndex !== null) {
                selectedIndex = (selectedIndex - 1 + alphabetData.length) % alphabetData.length;
                updateModalContent();
                replayLetter();
            }
        }

        // --- QUIZ MODE LOGIC ---
        function startNewQuizRound() {
            isQuizLocked = false;
            document.getElementById('feedback-msg').innerText = "";
            document.getElementById('feedback-msg').className = "text-center mt-6 h-8 font-bold text-xl";

            // 1. Pick correct answer
            const targetIndex = Math.floor(Math.random() * alphabetData.length);
            currentQuizTarget = alphabetData[targetIndex];

            // 2. Pick 3 distractions
            let options = [currentQuizTarget];
            while (options.length < 4) {
                const randomItem = alphabetData[Math.floor(Math.random() * alphabetData.length)];
                if (!options.includes(randomItem)) {
                    options.push(randomItem);
                }
            }

            // 3. Shuffle
            options.sort(() => Math.random() - 0.5);

            // 4. Render Options
            const quizContainer = document.getElementById('quiz-options');
            quizContainer.innerHTML = '';
            
            // Update prompt text
            document.getElementById('quiz-target-letter').innerText = "?";

            options.forEach(item => {
                const btn = document.createElement('button');
                btn.className = "bg-white border-2 border-purple-100 rounded-2xl p-6 shadow-sm hover:bg-purple-50 active:scale-95 transition-all text-5xl font-bold text-gray-700 h-32 flex items-center justify-center";
                btn.innerText = item.letter;
                
                // ×‘×“×™×§×ª ×ª×©×•×‘×”
                btn.onclick = (e) => checkAnswer(item, btn);
                quizContainer.appendChild(btn);
            });

            // 5. Play Audio
            playQuizPrompt();
        }

        function playQuizPrompt() {
            if (!currentQuizTarget) return;
            
            // × ×ª×™×‘ ×œ×§×•×‘×¥ ×”×”×§×œ×˜×” ×©×œ ×”×©××œ×”
            const promptFile = 'audio/quiz_prompt.mp3';
            const promptAudio = new Audio(promptFile);

            // 1. ×”×’×“×¨×ª ×¨×¦×£: ×›×©×§×•×‘×¥ ×”×©××œ×” ××¡×ª×™×™× -> ×× ×’× ×™× ××ª ×”××•×ª
            promptAudio.onended = function() {
                const index = alphabetData.indexOf(currentQuizTarget);
                // × ×™×’×•×Ÿ ×”××•×ª (××”×§×•×‘×¥ ××• TTS)
                speak(currentQuizTarget.phonetic, `letter_${index + 1}.mp3`);
            };

            // 2. ×˜×™×¤×•×œ ×‘×©×’×™××•×ª (×× ×”×§×•×‘×¥ ×œ× ×§×™×™× -> ×—×•×–×¨×™× ×œ-TTS ×”×™×©×Ÿ)
            promptAudio.onerror = function() {
                console.log('Quiz prompt file missing, using TTS fallback');
                const questionStart = new SpeechSynthesisUtterance("×Öµ×™×¤Ö¹×” ×”Ö¸××•Ö¹×ª");
                questionStart.lang = 'he-IL';
                questionStart.rate = 0.9;
                
                questionStart.onend = function() {
                    const index = alphabetData.indexOf(currentQuizTarget);
                    speak(currentQuizTarget.phonetic, `letter_${index + 1}.mp3`);
                };
                
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(questionStart);
            };

            // 3. ×”×ª×—×œ×ª ×”× ×™×’×•×Ÿ
            promptAudio.play().catch(err => {
                console.log('Audio play failed:', err);
                // ×‘××§×¨×” ×©×œ ×©×’×™××ª × ×™×’×•×Ÿ (×œ××©×œ ×—×¡×™××ª ×“×¤×“×¤×Ÿ), ××¤×¢×™×œ×™× ××ª ×”-Fallback
                promptAudio.onerror();
            });
        }

        function checkAnswer(selectedItem, btnElement) {
            if (isQuizLocked) return;

            if (selectedItem === currentQuizTarget) {
                // SUCCESS
                isQuizLocked = true;
                quizScore += 1;
                document.getElementById('score-display').innerText = quizScore;
                
                // Visuals
                btnElement.classList.remove('bg-white', 'border-purple-100');
                btnElement.classList.add('bg-green-100', 'border-green-400', 'text-green-700', 'scale-110');
                document.getElementById('quiz-target-letter').innerText = currentQuizTarget.letter;
                
                const feedback = document.getElementById('feedback-msg');
                feedback.innerText = "×›Ö¼Ö¹×œ ×”Ö·×›Ö¼Ö¸×‘×•Ö¹×“! ğŸ‘";
                feedback.classList.add('text-green-600', 'bounce');

                // Confetti
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });

                // Audio Success
                const utterance = new SpeechSynthesisUtterance("×Ö°×¦×•Ö¼×™Ö¼Ö¸×Ÿ!");
                utterance.lang = 'he-IL';
                window.speechSynthesis.speak(utterance);

                // Next round delay
                setTimeout(() => {
                    startNewQuizRound();
                }, 2500);

            } else {
                // FAILURE
                btnElement.classList.add('bg-red-50', 'border-red-200', 'shake');
                setTimeout(() => btnElement.classList.remove('shake'), 500);
                
                const feedback = document.getElementById('feedback-msg');
                feedback.innerText = "× Ö·×¡Ö¼×•Ö¼ ×©××•Ö¼×‘...";
                feedback.classList.add('text-red-400');
                
                // Audio Fail
                const utterance = new SpeechSynthesisUtterance("×œÖ¹× × ×•Ö¹×¨Ö¸×");
                utterance.lang = 'he-IL';
                window.speechSynthesis.speak(utterance);
            }
        }
    </script>
</body>
</html>